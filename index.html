<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fishbone Pro - ZigZag Layout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f5f5f7;
            color: #1d1d1f;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @media print {
            body { background-color: white; }
            .print\:hidden { display: none !important; }
            .print\:p-0 { padding: 0 !important; }
            .print\:shadow-none { box-shadow: none !important; }
            .print\:border-none { border: none !important; }
            .print\:bg-white { background-color: white !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useRef, useEffect } = React;

        // --- Icons ---
        const Plus = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Trash2 = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const Save = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
        const FolderOpen = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>;
        const Printer = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>;
        const Maximize = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg>;
        const FileText = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>;

        // --- Config ---
        const STATUS_OPTIONS = {
            UNVERIFIED: { id: 'UNVERIFIED', label: '❓ Unverified', color: '#64748b', boneColor: '#94a3b8', bg: 'bg-slate-100 text-slate-600' },
            PRECLUDED: { id: 'PRECLUDED', label: '❌ Precluded', color: '#cbd5e1', boneColor: '#e2e8f0', bg: 'bg-gray-100 text-gray-400 line-through' },
            CONCLUDED: { id: 'CONCLUDED', label: '✅ Concluded', color: '#dc2626', boneColor: '#ef4444', bg: 'bg-red-50 text-red-700 font-bold border-red-200' }
        };

        const DEMO_DATA = [
            { id: 1, category: "能源/電力", cause: "點火系統供電", factor: "電池沒電 (更換測試)", method: "更換全新電池", evidence: "成功點燃", status: 'CONCLUDED' },
            { id: 2, category: "能源/電力", cause: "點火系統供電", factor: "電池盒彈簧嚴重鏽蝕", method: "目視檢查", evidence: "正常", status: 'PRECLUDED' },
            { id: 21, category: "能源/電力", cause: "點火系統供電", factor: "電池接點接觸不良", method: "清潔接點", evidence: "無效", status: 'PRECLUDED' },
            { id: 3, category: "能源/電力", cause: "瓦斯供應異常", factor: "瓦斯桶沒氣", method: "搖晃確認", evidence: "有氣", status: 'PRECLUDED' },
            { id: 4, category: "設備硬體", cause: "點火針故障", factor: "點火針積碳", method: "清潔測試", evidence: "無效", status: 'PRECLUDED' },
            { id: 5, category: "設備硬體", cause: "水盤異常", factor: "皮膜破裂", method: "拆機", evidence: "待確認", status: 'UNVERIFIED' },
            { id: 6, category: "人為操作", cause: "模式設定錯誤", factor: "誤切到夏天模式", method: "檢查面板", evidence: "正常", status: 'PRECLUDED' },
        ];

        // --- Helper: Estimate Text Width ---
        const getTextWidth = (text) => {
            const canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement("canvas"));
            const context = canvas.getContext("2d");
            context.font = "12px system-ui";
            const metrics = context.measureText(text || "");
            return metrics.width + 10;
        };

        // --- Rich Text Editor ---
        const RichTextEditor = ({ value, onChange }) => {
            const editorRef = useRef(null);
            useEffect(() => {
                if (editorRef.current && editorRef.current.innerHTML !== value) {
                    if (value === '' || value === '<p><br></p>' || Math.abs(editorRef.current.innerHTML.length - value.length) > 10) {
                        editorRef.current.innerHTML = value;
                    }
                }
            }, [value]);
            const handleInput = () => editorRef.current && onChange(editorRef.current.innerHTML);
            const exec = (cmd, val) => { document.execCommand(cmd, false, val); editorRef.current?.focus(); };
            
            const handlePaste = (e) => {
                const items = e.clipboardData.items;
                for (let i = 0; i < items.length; i++) {
                    if (items[i].type.indexOf("image") !== -1) {
                        e.preventDefault();
                        const blob = items[i].getAsFile();
                        if (blob) {
                            const reader = new FileReader();
                            reader.onload = (ev) => {
                                document.execCommand('insertHTML', false, `<img src="${ev.target?.result}" style="max-width:100%; border-radius: 8px; margin: 10px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1);" />`);
                                handleInput();
                            };
                            reader.readAsDataURL(blob);
                        }
                    }
                }
            };

            return (
                <div className="w-full bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mt-6 print:border-none print:shadow-none">
                    <div className="bg-slate-50 border-b border-slate-200 px-3 py-2 flex items-center gap-2 print:hidden">
                        <span className="text-xs font-bold text-slate-400 mr-2 uppercase">Project Notes</span>
                        <button onClick={() => exec('bold')} className="p-1 hover:bg-white rounded font-bold border border-transparent">B</button>
                        <button onClick={() => exec('italic')} className="p-1 hover:bg-white rounded italic border border-transparent">I</button>
                        <button onClick={() => exec('foreColor', '#ef4444')} className="w-4 h-4 rounded-full bg-red-500"></button>
                        <button onClick={() => exec('foreColor', '#3b82f6')} className="w-4 h-4 rounded-full bg-blue-500"></button>
                    </div>
                    <div ref={editorRef} contentEditable className="p-6 min-h-[150px] outline-none text-slate-700 text-sm print:p-0" onInput={handleInput} onPaste={handlePaste} dangerouslySetInnerHTML={{__html: value}} />
                </div>
            );
        };

        const App = () => {
            const [problem, setProblem] = useState("熱水器不熱");
            const [rows, setRows] = useState(DEMO_DATA);
            const [notes, setNotes] = useState("<div>Notes...</div>");
            const [scale, setScale] = useState(1);
            const [pan, setPan] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
            const fileInputRef = useRef(null);

            const handleRowChange = (id, field, value) => setRows(rows.map(r => r.id === id ? { ...r, [field]: value } : r));
            const insertRowAfter = (index) => {
                const currentRow = rows[index];
                const newId = rows.length > 0 ? Math.max(...rows.map(r => r.id)) + 1 : 1;
                const newRows = [...rows];
                newRows.splice(index + 1, 0, { ...currentRow, id: newId, factor: "New Factor", method: "", evidence: "", status: 'UNVERIFIED' });
                setRows(newRows);
            };
            const deleteRow = (id) => setRows(rows.filter(r => r.id !== id));
            const addFirstRow = () => setRows([{ id: 1, category: "Primary", cause: "Secondary", factor: "Factor", method: "", evidence: "", status: 'UNVERIFIED' }]);
            const clearData = () => { if(confirm("Clear all data?")) { setRows([]); setNotes(""); }};

            const handleSave = () => {
                const blob = new Blob([JSON.stringify({ problem, rows, notes, version: "3.1-ZigZag" }, null, 2)], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `RCA_${problem}.json`;
                link.click();
            };
            const handleLoad = (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const data = JSON.parse(ev.target?.result);
                        if(data.problem) setProblem(data.problem);
                        if(data.rows) setRows(data.rows);
                        if(data.notes) setNotes(data.notes);
                    } catch (err) { alert("Invalid file"); }
                };
                reader.readAsText(file);
                e.target.value = '';
            };
            const handlePrint = () => { setScale(0.85); setPan({x:0, y:0}); setTimeout(() => window.print(), 100); };

            const fishboneStructure = useMemo(() => {
                const catGroups = {};
                rows.forEach(row => {
                    const cat = row.category || "Uncategorized";
                    if (!catGroups[cat]) catGroups[cat] = [];
                    catGroups[cat].push(row);
                });
                return Object.entries(catGroups).map(([catName, catRows]) => {
                    const causeGroups = {};
                    catRows.forEach(row => {
                        const cause = row.cause || "Unspecified";
                        if (!causeGroups[cause]) causeGroups[cause] = [];
                        causeGroups[cause].push(row);
                    });
                    return {
                        name: catName,
                        causes: Object.entries(causeGroups).map(([causeName, factors]) => ({
                            name: causeName,
                            factors: factors
                        }))
                    };
                });
            }, [rows]);

            const CONFIG = {
                baseWidth: 1200, height: 750, spineY: 375, 
                headX_Offset: 150, spineStart: 100, 
                categorySpacing: 350,  
                minBoneLength: 220
            };

            const renderFishbone = () => {
                const categoriesWithLayout = fishboneStructure.map(cat => {
                    const causesWithLayout = cat.causes.map(cause => {
                        let currentPos = 40;
                        const factorsWithPos = cause.factors.map((f, i) => {
                            const width = getTextWidth(f.factor);
                            // Only add spacing for every other item if we are zig-zagging strictly horizontally
                            // But to be safe, we just advance a bit less because they are on different vertical levels
                            const step = width * 0.7 + 10; 
                            const pos = currentPos;
                            currentPos += step; 
                            return { ...f, xOffset: pos, width };
                        });
                        const totalLen = currentPos + 40; 
                        return { ...cause, factors: factorsWithPos, totalLen };
                    });
                    return { ...cat, causes: causesWithLayout };
                });

                const dynamicHeadX = Math.max(
                    CONFIG.baseWidth - CONFIG.headX_Offset, 
                    200 + categoriesWithLayout.length * CONFIG.categorySpacing
                );
                
                const elements = [];

                elements.push(<path key="tail" d={`M ${CONFIG.spineStart} ${CONFIG.spineY} L ${CONFIG.spineStart - 60} ${CONFIG.spineY - 50} Q ${CONFIG.spineStart - 40} ${CONFIG.spineY} ${CONFIG.spineStart - 60} ${CONFIG.spineY + 50} Z`} fill="#3b82f6" opacity="0.8" />);
                elements.push(<line key="spine" x1={CONFIG.spineStart} y1={CONFIG.spineY} x2={dynamicHeadX} y2={CONFIG.spineY} stroke="#475569" strokeWidth="6" strokeLinecap="round" />);
                
                elements.push(
                    <g key="head">
                        <path d={`M ${dynamicHeadX} ${CONFIG.spineY - 90} L ${dynamicHeadX + 240} ${CONFIG.spineY} L ${dynamicHeadX} ${CONFIG.spineY + 90} Q ${dynamicHeadX - 40} ${CONFIG.spineY} ${dynamicHeadX} ${CONFIG.spineY - 90} Z`} fill="#3b82f6" className="drop-shadow-xl" />
                        <circle cx={dynamicHeadX + 160} cy={CONFIG.spineY - 20} r="10" fill="white" />
                        <circle cx={dynamicHeadX + 160} cy={CONFIG.spineY - 20} r="4" fill="black" />
                        <foreignObject x={dynamicHeadX - 30} y={CONFIG.spineY - 70} width={260} height={140} style={{pointerEvents: 'none'}}>
                            <div className="flex items-center justify-center h-full px-4 text-center">
                                <span className="text-white font-bold text-xl leading-tight drop-shadow-md">{problem}</span>
                            </div>
                        </foreignObject>
                    </g>
                );

                let currentX = dynamicHeadX - 260;

                categoriesWithLayout.forEach((catGroup, index) => {
                    const isTop = index % 2 === 0;
                    
                    // Increased spacing for zig-zag vertical clearance
                    let totalSpacingNeeded = catGroup.causes.length * 130 + 100;
                    const boneLength = Math.max(280, totalSpacingNeeded);
                    
                    const startY = CONFIG.spineY;
                    const endY = isTop ? startY - boneLength : startY + boneLength;
                    const boneEndX = currentX - (boneLength * 0.45); 

                    elements.push(
                        <g key={`cat-${index}`}>
                            <line x1={currentX} y1={startY} x2={boneEndX} y2={endY} stroke="#64748b" strokeWidth="4" strokeLinecap="round" />
                            <g transform={`translate(${boneEndX}, ${isTop ? endY - 40 : endY + 20})`}>
                                <rect x="-70" y="-10" width="140" height="34" rx="17" fill="white" stroke="#cbd5e1" strokeWidth="1" className="drop-shadow-sm" />
                                <text x="0" y="13" textAnchor="middle" fontWeight="bold" fill="#1e293b" fontSize="14">{catGroup.name}</text>
                            </g>
                        </g>
                    );

                    let distFromSpine = 70;

                    catGroup.causes.forEach((causeGroup, cIndex) => {
                        const totalDist = Math.sqrt(Math.pow(boneEndX - currentX, 2) + Math.pow(endY - startY, 2));
                        const t = distFromSpine / totalDist;
                        
                        const rootX = currentX + (boneEndX - currentX) * t;
                        const rootY = startY + (endY - startY) * t;

                        const causeLen = Math.max(160, causeGroup.totalLen);
                        const causeEndX = rootX + causeLen; 
                        const causeEndY = rootY;

                        elements.push(
                            <g key={`cause-${index}-${cIndex}`}>
                                <line x1={rootX} y1={rootY} x2={causeEndX} y2={causeEndY} stroke="#94a3b8" strokeWidth="3" strokeLinecap="round" />
                                <text x={causeEndX + 8} y={causeEndY + 5} fontSize="14" fontWeight="bold" fill="#334155" textAnchor="start">{causeGroup.name}</text>
                            </g>
                        );

                        // Zig-Zag Factors
                        causeGroup.factors.forEach((factor, fIndex) => {
                            const factorRootX = rootX + factor.xOffset;
                            const factorRootY = rootY;
                            
                            // Alternate Up/Down
                            const isUpFactor = fIndex % 2 === 0;
                            
                            const branchLen = 30;
                            // If primary bone is Top: Up is -Y, Down is +Y
                            // If primary bone is Bottom: still same logic relative to horizontal secondary bone
                            const branchEndY = factorRootY + (isUpFactor ? -branchLen : branchLen);
                            const branchEndX = factorRootX + 15; // slight angle

                            const statusConfig = STATUS_OPTIONS[factor.status];
                            const isConcluded = factor.status === 'CONCLUDED';
                            const isPrecluded = factor.status === 'PRECLUDED';
                            
                            const strokeColor = isConcluded ? statusConfig.boneColor : (isPrecluded ? '#cbd5e1' : '#94a3b8');
                            const strokeWidth = isConcluded ? 2.5 : 1.5;
                            const textColor = isConcluded ? '#dc2626' : (isPrecluded ? '#94a3b8' : '#64748b');
                            const textDec = isPrecluded ? 'line-through' : 'none';

                            // Text Position
                            const textY = isUpFactor ? branchEndY - 5 : branchEndY + 14;

                            elements.push(
                                <g key={`fact-${factor.id}`}>
                                    <circle cx={factorRootX} cy={factorRootY} r="2" fill="#cbd5e1" />
                                    <line x1={factorRootX} y1={factorRootY} x2={branchEndX} y2={branchEndY} stroke={strokeColor} strokeWidth={strokeWidth} />
                                    <text x={branchEndX - 5} y={textY} fontSize="12" fill={textColor} 
                                        textDecoration={textDec} fontWeight={isConcluded ? 'bold' : 'normal'}
                                        textAnchor="start"
                                    >
                                        {factor.factor}
                                    </text>
                                </g>
                            );
                        });

                        distFromSpine += 130; // Increased spacing for zig-zag clearance
                    });

                    currentX -= CONFIG.categorySpacing;
                });

                return elements;
            };

            const fishboneElements = renderFishbone();

            const handleWheel = (e) => {
                if (e.ctrlKey) {
                    e.preventDefault();
                    const delta = e.deltaY > 0 ? 0.9 : 1.1;
                    setScale(s => Math.min(Math.max(0.3, s * delta), 3));
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col text-slate-800 font-sans print:bg-white">
                    <header className="bg-white border-b border-slate-200 px-6 py-3 flex justify-between items-center sticky top-0 z-50 print:hidden">
                        <div className="flex items-center gap-3">
                            <div className="bg-slate-900 text-white p-1.5 rounded-lg"><Maximize size={20} /></div>
                            <div><h1 className="font-bold text-lg leading-tight">Fishbone Pro</h1><p className="text-xs text-slate-500">RCA Edition</p></div>
                        </div>
                        <div className="flex gap-2">
                            <input type="file" ref={fileInputRef} onChange={handleLoad} accept=".json" className="hidden" />
                            <button onClick={() => fileInputRef.current?.click()} className="flex items-center gap-2 px-3 py-1.5 bg-white border border-slate-300 rounded-md text-sm font-medium hover:bg-slate-50 transition"><FolderOpen size={16} /> Open</button>
                            <button onClick={handleSave} className="flex items-center gap-2 px-3 py-1.5 bg-white border border-slate-300 rounded-md text-sm font-medium hover:bg-slate-50 transition"><Save size={16} /> Save</button>
                            <div className="w-px h-8 bg-slate-200 mx-1"></div>
                            <button onClick={handlePrint} className="flex items-center gap-2 px-4 py-1.5 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 shadow-sm transition"><Printer size={16} /> Print / PDF</button>
                        </div>
                    </header>

                    <div className="flex-1 flex flex-col p-6 gap-6 max-w-[1600px] mx-auto w-full print:p-0">
                        <div className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden relative print:border-none print:shadow-none" style={{height: '550px'}}>
                            <div className="absolute top-4 left-4 z-10 bg-white/90 p-3 rounded-xl border border-slate-200 shadow-sm backdrop-blur print:hidden">
                                <label className="block text-xs font-bold text-slate-400 uppercase mb-1">Problem Statement</label>
                                <textarea value={problem} onChange={(e) => setProblem(e.target.value)} className="bg-transparent font-bold text-lg text-slate-800 w-64 outline-none resize-none h-auto overflow-hidden" rows={2}/>
                            </div>
                            <div className="absolute bottom-4 right-4 z-10 flex gap-2 print:hidden">
                                <button onClick={() => {setScale(1); setPan({x:0,y:0})}} className="p-2 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 shadow-sm text-xs font-bold text-slate-600">Reset View</button>
                            </div>
                            <div className={`w-full h-full bg-slate-50 cursor-grab active:cursor-grabbing print:bg-white ${isDragging ? 'cursor-grabbing' : ''}`}
                                onWheel={handleWheel}
                                onMouseDown={(e) => { if(e.button===0) { setIsDragging(true); setDragStart({x: e.clientX-pan.x, y: e.clientY-pan.y}) }}}
                                onMouseMove={(e) => { if(isDragging) setPan({x: e.clientX-dragStart.x, y: e.clientY-dragStart.y}) }}
                                onMouseUp={() => setIsDragging(false)} onMouseLeave={() => setIsDragging(false)}>
                                <svg width="100%" height="100%" viewBox={`${-pan.x} ${-pan.y} 1200 750`} style={{transform: `scale(${scale})`, transformOrigin: '0 0', transition: isDragging ? 'none' : 'transform 0.1s ease-out'}}>
                                    <defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e2e8f0" strokeWidth="1"/></pattern></defs>
                                    <rect x={-5000} y={-5000} width="10000" height="10000" fill="url(#grid)" className="print:hidden" />
                                    {fishboneElements}
                                </svg>
                            </div>
                        </div>

                        <div className="bg-white rounded-2xl border border-slate-200 shadow-sm p-6 print:border-none print:shadow-none print:p-0">
                            <div className="flex justify-between items-center mb-4 print:hidden">
                                <h2 className="text-lg font-bold flex items-center gap-2"><FileText size={20} className="text-blue-600"/>Hypothesis Verification</h2>
                                <div className="flex gap-2">
                                    {rows.length === 0 && <button onClick={addFirstRow} className="px-3 py-1.5 bg-blue-50 text-blue-600 rounded-md text-sm font-medium hover:bg-blue-100 flex items-center gap-1"><Plus size={16}/> Add First Row</button>}
                                    <button onClick={clearData} className="px-3 py-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-md text-sm transition flex items-center gap-1"><Trash2 size={16}/> Clear List</button>
                                </div>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-left text-sm border-collapse min-w-[1000px]">
                                    <thead>
                                        <tr className="border-b border-slate-200 text-slate-500 text-xs uppercase tracking-wider">
                                            <th className="py-3 px-2 w-[12%]">Primary Bone (Category)</th>
                                            <th className="py-3 px-2 w-[18%]">Secondary Bone (Cause)</th>
                                            <th className="py-3 px-2 w-[18%] text-blue-700">Specific Factor (Hypothesis)</th>
                                            <th className="py-3 px-2 w-[20%]">Verification Method</th>
                                            <th className="py-3 px-2 w-[15%]">Evidence / Result</th>
                                            <th className="py-3 px-2 w-[12%]">Conclusion</th>
                                            <th className="py-3 px-2 w-[5%] text-right print:hidden"></th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {rows.map((row, index) => (
                                            <tr key={row.id} className="group hover:bg-slate-50 transition-colors">
                                                <td className="p-2 align-top"><input type="text" value={row.category} onChange={e => handleRowChange(row.id, 'category', e.target.value)} className="w-full bg-transparent font-bold text-slate-700 outline-none border-b border-transparent focus:border-blue-400 px-1 py-1" placeholder="Category" /></td>
                                                <td className="p-2 align-top"><input type="text" value={row.cause} onChange={e => handleRowChange(row.id, 'cause', e.target.value)} className="w-full bg-transparent text-slate-700 outline-none border-b border-transparent focus:border-blue-400 px-1 py-1" placeholder="Cause" /></td>
                                                <td className="p-2 align-top bg-blue-50/30 rounded"><input type="text" value={row.factor} onChange={e => handleRowChange(row.id, 'factor', e.target.value)} className="w-full bg-transparent font-medium text-blue-900 outline-none border-b border-transparent focus:border-blue-400 px-1 py-1" placeholder="Hypothesis" /></td>
                                                <td className="p-2 align-top"><textarea value={row.method} onChange={e => handleRowChange(row.id, 'method', e.target.value)} className="w-full bg-transparent text-slate-600 outline-none border-b border-transparent focus:border-blue-400 px-1 py-1 resize-none h-10" placeholder="Method" /></td>
                                                <td className="p-2 align-top"><textarea value={row.evidence} onChange={e => handleRowChange(row.id, 'evidence', e.target.value)} className="w-full bg-transparent text-slate-600 outline-none border-b border-transparent focus:border-blue-400 px-1 py-1 resize-none h-10" placeholder="Result" /></td>
                                                <td className="p-2 align-top">
                                                    <select value={row.status} onChange={e => handleRowChange(row.id, 'status', e.target.value)} className={`w-full text-xs font-bold rounded-md px-2 py-1.5 border-none outline-none cursor-pointer appearance-none ${STATUS_OPTIONS[row.status].bg}`}>
                                                        {Object.values(STATUS_OPTIONS).map(opt => <option key={opt.id} value={opt.id}>{opt.label}</option>)}
                                                    </select>
                                                </td>
                                                <td className="p-2 text-right print:hidden">
                                                    <div className="flex justify-end gap-1">
                                                        <button onClick={() => insertRowAfter(index)} className="p-1.5 text-blue-600 hover:bg-blue-50 rounded" title="Insert Below"><Plus size={16}/></button>
                                                        <button onClick={() => deleteRow(row.id)} className="p-1.5 text-red-500 hover:bg-red-50 rounded" title="Delete"><Trash2 size={16}/></button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <RichTextEditor value={notes} onChange={setNotes} />
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
